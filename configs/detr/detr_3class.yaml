experiment:
  name: detr_tomato_3class_exp001
  seed: 42
  save_dir: exp
  log_image_enabled: true
  log_image_interval: 5  # validation 시 N epoch마다 이미지 저장

model:
  arch_name: detr
  pretrained_path: facebook/detr-resnet-50
  num_labels: 3
  score_threshold: 0.5

  # Optimizer settings
  learning_rate: 0.0003
  lr_backbone: 0.00003
  weight_decay: 0.0001
  
  # Detection settings
  num_queries: 100  # DETR의 object queries 수
  bbox_loss_coef: 5.0
  giou_loss_coef: 2.0
  class_loss_coef: 1.0
  
  # Architecture details (선택사항)
  hidden_dim: 256
  nheads: 8
  num_encoder_layers: 6
  num_decoder_layers: 6
  dim_feedforward: 2048
  dropout: 0.1

data:
  dataset_name: TomatOD_COCO_3
  num_classes: 3
  class_names:
    - fully-ripe
    - semi-ripe
    - unripe
  
  # Paths
  data_root: data/TomatOD_COCO_3
  train_dir: data/TomatOD_COCO_3/train
  val_dir: data/TomatOD_COCO_3/val
  test_dir: data/TomatOD_COCO_3/test

  # Annotations
  train_ann_file: custom_train.json
  val_ann_file: custom_val.json
  test_ann_file: custom_test.json
  
  # DataLoader settings
  batch_size: 24
  num_workers: 0  # Windows에서는 0 권장
  pin_memory: true
  
  # Image preprocessing
  image_size: 800
  
  # Data augmentation
  use_augmentation: true
  augmentation:
    color_jitter:
      brightness: 0.2
      contrast: 0.2
      saturation: 0.2
      hue: 0.05
    sharpness:
      factor: 1.5
      prob: 0.2

trainer:
  max_epochs: 100
  accelerator: gpu
  devices: 1
  precision: 16-mixed
  enable_progress_bar: true
  log_every_n_steps: 25 # epoch당 1번만 로그
  val_check_interval: 1.0  # 매 epoch마다 validation
  check_val_every_n_epoch: 1

  # Gradient settings
  accumulate_grad_batches: 4  # 실효 배치: 24 × 4 = 96
  gradient_clip_val: 0.1
  gradient_clip_algorithm: norm
  
  
  # Callbacks
  early_stopping:
    monitor: val_loss
    patience: 20
    mode: min
  checkpoint:
    monitor: val_loss
    mode: min
    save_top_k: 3
    save_last: true
    filename: best-{epoch:02d}-{val_loss:.2f}
    auto_insert_metric_name: false


evaluation:
  score_threshold: 0.5
  iou_threshold: 0.5
  nms_threshold: 0.5
  max_detections: 100
  batch_size: 8  # 평가용 배치 크기 (학습과 다를 수 있음)
  
  # 저장할 메트릭들
  metrics:
    - map  # mean Average Precision
    - map_50
    - map_75
    - mar_1
    - mar_10
    - mar_100
    - precision
    - recall
    - f1_score
  
  # 시각화 옵션
  save_predictions: true
  save_confusion_matrix: true
  save_per_class_metrics: true


logging:
  tensorboard:
    enabled: true
    log_graph: false
  csv:
    enabled: true
  wandb:
    enabled: false
    project: tomato-detection
    entity: null

hardware:
  device: cuda
  amp_enabled: true
  cudnn_benchmark: true
  deterministic: false